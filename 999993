999993

Как работают методы get and find_element

Разберем еще один простой тест на WebDriver, проверяющий работу кнопки.

Тестовый сценарий выглядит так:
1. Открыть страницу https://suninjuly.github.io/wait1.html
2. Нажать на кнопку  "Verify"
3. Проверить, что появилась надпись "Verification was successful!"

Для открытия страницы мы используем метод get, затем находим нужную кнопку с помощью из методов
find_element(By...) и нажимаем на нее с помощью метода click. Далее находим новый элемент с текстом
и проверяем соответствие текста на странице ожидаемому тексту.

Вот как выглядит код автотеста:

from selenium import webdriver
from selenium.webdriver.common.by import By

browser = webdriver.Chrome()
browser.get("http://suninjuly.github.io/wait1.html")

button = browser.find_element(By.ID, "verify")
button.click()
message = browser.find_element(By.ID, "verify_message")

assert "successful" in message.text

Попробуйте сначала выполнить тест вручную, а затем запустить автотест. В первом случае, вы завершите
тест успешно, во втором случае автотест упадет с сообщенияем NoSuchElementException для элемента с
id="verify". Почему так происходит?

Команды в Python выполняются синхронно, то есть, строго последовательно. Пока не завершится команда
get, не начнется поиск кнопки. Пока кнопка не найдена, не будет сделан клик по кнопке и так далее.

Но тест будет работать абсолютно стабильно, только если в данной веб-странице не используется
JavaScript(что маловероятно для современного веба). Метод get дожидается инфомрации от браузера о том,
что страница загружена, и только после этого наш тест переходит к поиску кнопки. Если страница
интерактивная, то браузер будет считать, что страница загружена, при этом продолжат выполняться 
загруженные браузером скрипты. Скрипт может управлять появлением кнопки на странице и показывать ее, например,
с задержкой, чтобы кнопка красивл и медленно возникала на странице. В это случае наш тест упадет с уже
известной нам ошибкой NoSuchElementException, так как в момент выполнения команды button =
broser.find_element(By.ID, "verify") элемент с id="verify" еще не отображается на странице. На данной
странице пауза перед появлением кнопки установлена на 1 секунду, метод din_element() сделает только
одну попытку найти элемент и в случае неудачи уронит наш тест.
